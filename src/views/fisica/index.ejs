<%
// Normaliza los campos para que la vista SIEMPRE use id / fecha
const items = (Array.isArray(fisica) ? fisica : []).map(r => ({
  id:        r.id ?? r.id_fisica ?? r.ID_FISICA,
  voltaje:   r.voltaje,
  temperatura: r.temperatura,
  distancia: r.distancia,
  fecha:     r.fecha ?? r.fecha_datos ?? r.Fecha_Datos
}));
%>

<h1>Datos Generales del Levitador</h1>

<% if (error) { %>
  <p style="color:red"><%= error %></p>
<% } %>

<div class="container-center">
  <section class="contenedor table-panel">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Voltaje</th>
          <th>Temperatura</th>
          <th>Distancia</th>
          <th>Fecha</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <% if (items.length > 0) { %>
          <% items.forEach(r => { %>
            <tr>
              <td><%= r.id %></td>
              <td><%= r.voltaje %></td>
              <td><%= r.temperatura %></td>
              <td><%= r.distancia %></td>
              <td>
                <% const d = r.fecha ? new Date(typeof r.fecha === 'string' ? r.fecha.replace(' ','T') : r.fecha) : null; %>
                <%= d ? d.toISOString().replace('T',' ').slice(0,16) : '—' %>
              </td>

              <td>
                <a href="/fisica/<%= r.id %>">Ver</a>
                <a href="/fisica/<%= r.id %>/edit">Editar</a>
                <form action="/fisica/<%= r.id %>?_method=DELETE" method="POST" style="display:inline;">
                  <button type="submit" onclick="return confirm('¿Seguro que desea eliminar?')">Eliminar</button>
                </form>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="6" style="text-align:center">
              No hay registros aún. <a href="/fisica/create">Crea el primero</a>.
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </section>
</div>
